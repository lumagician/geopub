<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaflet GeoJSON Loader</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      body {
        display: flex;
        flex-direction: row;
        margin: 0;
        height: 100vh;
        font-family: Arial, sans-serif;
      }
      #editor {
        width: 50%;
        display: flex;
        flex-direction: column;
        background: #f0f0f0;
        box-sizing: border-box;
        padding: 20px;
        border-right: 1px solid #ccc;
      }
      #geojson-url {
        width: calc(100% - 10px);
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      #load-btn {
        padding: 8px 15px;
        margin-left: 10px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      #load-btn:hover {
        background-color: #0056b3;
      }
      #editor-controls {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }
      #geojson-editor {
        flex-grow: 1;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 10px;
        font-family: monospace;
        font-size: 14px;
        resize: none;
        background: white;
      }
      #update-btn {
        margin-top: 10px;
        padding: 10px;
        border: none;
        background-color: #28a745;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      #update-btn:hover {
        background-color: #218838;
      }
      #map {
        width: 50%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="editor">
      <div id="editor-controls">
        <input
          type="text"
          id="geojson-url"
          placeholder="Enter GeoJSON URL"
        />
        <button id="load-btn">Load GeoJSON</button>
      </div>
      <textarea
        id="geojson-editor"
        placeholder="Edit GeoJSON here..."
      ></textarea>
      <button id="update-btn">Update Map</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Initialize the map
      const map = L.map("map").setView([0, 0], 2); // Default view at world scale

      // Add OpenStreetMap tile layer
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "Â© OpenStreetMap contributors",
      }).addTo(map);

      // Layer group to manage GeoJSON data
      let currentLayer = null;

      // Function to load GeoJSON from a URL
      function loadGeoJSON(url) {
        fetch(url)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            // Remove the current layer if it exists
            if (currentLayer) {
              map.removeLayer(currentLayer);
            }
            // Add new GeoJSON data to the map
            currentLayer = L.geoJSON(data).addTo(map);
            map.fitBounds(currentLayer.getBounds()); // Adjust the map view to fit the GeoJSON data

            // Populate the editor with the GeoJSON data
            document.getElementById("geojson-editor").value = JSON.stringify(
              data,
              null,
              2
            );
          })
          .catch((error) => {
            alert(`Failed to load GeoJSON: ${error.message}`);
          });
      }

      // Function to update the map with edited GeoJSON
      function updateMapFromEditor() {
        const geojsonText = document.getElementById("geojson-editor").value;
        try {
          const geojsonData = JSON.parse(geojsonText);

          // Remove the current layer if it exists
          if (currentLayer) {
            map.removeLayer(currentLayer);
          }
          // Add updated GeoJSON data to the map
          currentLayer = L.geoJSON(geojsonData).addTo(map);
          map.fitBounds(currentLayer.getBounds()); // Adjust the map view to fit the GeoJSON data
        } catch (error) {
          alert("Invalid GeoJSON data. Please check your input.");
        }
      }

      // Event listener for the Load button
      document.getElementById("load-btn").addEventListener("click", () => {
        const url = document.getElementById("geojson-url").value;
        if (url) {
          loadGeoJSON(url);
        } else {
          alert("Please enter a valid GeoJSON URL.");
        }
      });

            // Debounce function to limit the frequency of function execution
            function debounce(func, delay) {
        let timeout;
        return function (...args) {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), delay);
        };
      }

      // Function to update the map with edited GeoJSON
      function updateMapFromEditor() {
        const geojsonText = document.getElementById("geojson-editor").value;
        try {
          const geojsonData = JSON.parse(geojsonText);

          // Remove the current layer if it exists
          if (currentLayer) {
            map.removeLayer(currentLayer);
          }
          // Add updated GeoJSON data to the map
          currentLayer = L.geoJSON(geojsonData).addTo(map);
          map.fitBounds(currentLayer.getBounds()); // Adjust the map view to fit the GeoJSON data
        } catch (error) {
          console.error("Invalid GeoJSON data. Ignoring changes.");
        }
      }

      // Debounced version of the updateMapFromEditor function
      const debouncedUpdateMap = debounce(updateMapFromEditor, 500);

      // Event listener for changes in the textarea
      document
        .getElementById("geojson-editor")
        .addEventListener("input", debouncedUpdateMap);


      // Event listener for the Update button
      document
        .getElementById("update-btn")
        .addEventListener("click", updateMapFromEditor);
    </script>
  </body>
</html>
